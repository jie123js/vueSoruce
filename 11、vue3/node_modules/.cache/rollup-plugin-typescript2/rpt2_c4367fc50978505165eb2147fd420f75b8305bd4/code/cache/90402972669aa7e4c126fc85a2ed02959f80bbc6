{"code":"export function effect(fn, option = {}) {\r\n    //fn默认是不具备数据变化更新视图的功能\r\n    let effect = createReactiveEffect(fn, option); //把fn包裹成一个响应式的函数\r\n    if (!option.lazy) {\r\n        effect();\r\n    }\r\n    return effect;\r\n}\r\nlet uid = 0;\r\nlet activeEffect;\r\nfunction createReactiveEffect(fn, option) {\r\n    const effect = function () {\r\n        //需要把effect暴露出去\r\n        activeEffect = effect; //类似以前vue2的 Dep.target = watcher\r\n        fn();\r\n        activeEffect = null;\r\n    };\r\n    effect.id = uid++;\r\n    effect._isEffect = true;\r\n    effect.raw = fn;\r\n    effect.deps = [];\r\n    effect.options = option;\r\n    return effect;\r\n}\r\nconst targetMap = new WeakMap(); //为什么里面不用weakmap因为weakmap的key必须是对象\r\nexport function track(target, type, key) {\r\n    //创建一个{obj:(name:[effect.effect])}  建是对象,值是一个map,map里面值是一个set\r\n    if (!activeEffect) {\r\n        //不在effet里面的不进行依赖收集\r\n        return;\r\n    }\r\n    console.log(111);\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()));\r\n    }\r\n    let dep = depsMap.get(key);\r\n    if (!dep) {\r\n        depsMap.set(key, (dep = new Set()));\r\n    }\r\n    if (!dep.has(activeEffect)) {\r\n        dep.add(activeEffect);\r\n    }\r\n    console.log(targetMap);\r\n}\r\nexport function trigger(target, key, value) {\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap)\r\n        return;\r\n    const effects = depsMap.get(key);\r\n    effects.forEach((effect) => effect());\r\n}\r\n//# sourceMappingURL=effect.js.map","references":[],"map":"{\"version\":3,\"file\":\"effect.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/effect.ts\"],\"names\":[],\"mappings\":\"AAAA,MAAM,UAAU,MAAM,CAAC,EAAE,EAAE,SAAc,EAAE;IACzC,qBAAqB;IACrB,IAAI,MAAM,GAAG,oBAAoB,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,gBAAgB;IAC/D,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;QAChB,MAAM,EAAE,CAAC;KACV;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,IAAI,GAAG,GAAG,CAAC,CAAC;AACZ,IAAI,YAAY,CAAC;AACjB,SAAS,oBAAoB,CAAC,EAAE,EAAE,MAAM;IACtC,MAAM,MAAM,GAAG;QACb,eAAe;QACf,YAAY,GAAG,MAAM,CAAC,CAAC,gCAAgC;QACvD,EAAE,EAAE,CAAC;QACL,YAAY,GAAG,IAAI,CAAC;IACtB,CAAC,CAAC;IACF,MAAM,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC;IAClB,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;IACxB,MAAM,CAAC,GAAG,GAAG,EAAE,CAAC;IAChB,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC;IACjB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC;IACxB,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,MAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC,CAAC,kCAAkC;AACnE,MAAM,UAAU,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG;IACrC,6DAA6D;IAC7D,IAAI,CAAC,YAAY,EAAE;QACjB,mBAAmB;QACnB,OAAO;KACR;IACD,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAEjB,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpC,IAAI,CAAC,OAAO,EAAE;QACZ,SAAS,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,OAAO,GAAG,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;KAC9C;IACD,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC3B,IAAI,CAAC,GAAG,EAAE;QACR,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC,CAAC,CAAC;KACrC;IACD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;QAC1B,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;KACvB;IACD,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACzB,CAAC;AACD,MAAM,UAAU,OAAO,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK;IACxC,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpC,IAAI,CAAC,OAAO;QAAE,OAAO;IACrB,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACjC,OAAO,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC;AACxC,CAAC\"}"}
